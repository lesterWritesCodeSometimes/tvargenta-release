<!-- SPDX-License-Identifier: LicenseRef-TVArgenta-NC-Attribution-Consult-First
     Proyecto: TVArgenta — Retro TV | Autor: Ricardo Sappia (rsflightronics@gmail.com)
     © 2025. No comercial, atribución y consulta previa. TAL CUAL, sin garantías.
     Ver LICENSE para términos completos.
-->
<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}TVArgenta{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { touch-action: manipulation; }
    .hide { display:none !important; }

    /* ---------- CRT Variables ---------- */
    :root {
      --logo-opacity: 0.07;
      --roll-height: 48%;
      --roll-overshoot: 140%;
      --roll-opacity: 0.20;
      --roll-duration: 12s;
      --crt-from: #0a0a0a;
      --crt-via:  #131111;
      --crt-to:   #3a0000;
      --crt-strength: 1;
    }
    .logo-mark { opacity: var(--logo-opacity); }

    /* ---------- CRT: scanlines ---------- */
    .crt-scanlines {
      background-image: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,0.10) 0px,
        rgba(255,255,255,0.10) 1px,
        rgba(0,0,0,0.04) 2px
      );
      opacity: .14;
      pointer-events: none;
    }

    /* ---------- CRT: gradient ---------- */
    .crt-gradient {
      background: linear-gradient(to bottom,
        color-mix(in lab, var(--crt-from) calc(var(--crt-strength)*100%), #000 0%),
        color-mix(in lab, var(--crt-via)  calc(var(--crt-strength)*100%), #000 0%),
        color-mix(in lab, var(--crt-to)   calc(var(--crt-strength)*100%), #000 0%)
      );
    }

    /* ---------- CRT: noise ---------- */
    .crt-noise {
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='128' height='128'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2' seed='7'/></filter><rect width='100%' height='100%' filter='url(%23n)'/></svg>");
      background-repeat: repeat;
      background-size: 220px 220px;
      mix-blend-mode: overlay;
      opacity: .03;
      pointer-events: none;
    }

    /* ---------- CRT: rolling band ---------- */
    @keyframes rollSweep {
      0%, 94%   { transform: translateY(calc(-1 * var(--roll-overshoot))); opacity: 0; }
      95%       { opacity: var(--roll-opacity); }
      100%      { transform: translateY(var(--roll-overshoot)); opacity: 0; }
    }

    .crt-roll { position: absolute; inset: 0; pointer-events: none; mix-blend-mode: screen; }

    .crt-roll::before {
      content:"";
      position:absolute; left:0; right:0;
      height: var(--roll-height);
      background: linear-gradient(
        to bottom,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255, calc(var(--roll-opacity) * .6)) 45%,
        rgba(255,255,255, var(--roll-opacity)) 50%,
        rgba(255,255,255, calc(var(--roll-opacity) * .6)) 55%,
        rgba(255,255,255,0) 100%
      );
      filter: blur(1px);
      transform: translateY(calc(-1 * var(--roll-overshoot)));
      animation: rollSweep var(--roll-duration) ease-in-out infinite;
    }

    /* ---------- Cards ---------- */
    .card {
      background: rgba(17,24,39,.45);
      backdrop-filter: blur(2px);
      position: relative;
    }

    /* ---------- Mobile adjustments ---------- */
    @media (max-width: 900px), (hover: none) and (pointer: coarse) {
      :root {
        --logo-opacity: 0.3;
        --crt-from: #0b0b0b;
        --crt-via:  #171111;
        --crt-to:   #4a0000;
        --crt-strength: 1;
      }
      .logo-mark {
        mix-blend-mode: screen;
        filter: brightness(1.25) contrast(1.35);
      }
      .crt-noise { opacity: .012; }
      .crt-scanlines { opacity: .06; }
      .card { background: rgba(17,24,39,.35); }
    }

    /* ---------- Navigation ---------- */
    .nav-link {
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-weight: 600;
      font-size: 0.875rem;
      transition: all 0.2s;
    }
    .nav-link:hover {
      background: rgba(255,255,255,0.1);
    }
    .nav-link.active {
      background: rgba(234,179,8,0.2);
      color: #facc15;
    }

    /* ---------- Language switcher ---------- */
    #lang-switcher {
      position: fixed;
      top: 10px;
      right: 12px;
      z-index: 9999;
      background: rgba(0, 0, 0, 0.7);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      color: #fff;
    }
    #lang-switcher select {
      background: transparent;
      border: none;
      color: #fff;
      font-size: 12px;
      padding: 2px 4px;
      cursor: pointer;
      outline: none;
    }

    {% block extra_styles %}{% endblock %}
  </style>
</head>
<body class="relative bg-black text-white min-h-screen font-mono overflow-x-hidden">
  <!-- CRT Background -->
  <div class="fixed inset-0 bg-black z-0">
    <div class="absolute inset-0 bg-gradient-to-b from-[#0a0a0a] via-[#111] to-[#1a0000]"></div>
    <div class="absolute inset-0 crt-noise" style="z-index:1"></div>
    <div class="absolute inset-0 crt-scanlines" style="z-index:2"></div>
    <div class="absolute inset-0 crt-roll" style="z-index:3"></div>
    <div class="absolute inset-0 flex items-center justify-center pointer-events-none" style="z-index:4">
      <img
        id="logoMark"
        src="{{ url_for('static', filename='background.png') }}"
        alt="TVArgenta logo"
        class="logo-mark filter blur-[1px] brightness-95 contrast-125 mix-blend-screen"
        style="height:auto; max-width:90vw; width:600px;"
      >
    </div>
  </div>

  <!-- Language Switcher -->
  <div id="lang-switcher">
    <select id="lang-select">
      <option value="es" {{ 'selected' if lang == 'es' else '' }}>ES</option>
      <option value="en" {{ 'selected' if lang == 'en' else '' }}>EN</option>
      <option value="de" {{ 'selected' if lang == 'de' else '' }}>DE</option>
    </select>
  </div>

  <!-- Main Content -->
  <div class="relative z-10 max-w-screen-lg mx-auto py-6 sm:py-8 px-3 sm:px-4">
    <!-- Logo -->
    <div class="flex justify-center mb-4 sm:mb-6">
      <a href="{{ url_for('index') }}" class="block">
        <img
          src="{{ url_for('static', filename='logo_tvar.png') }}"
          alt="TVArgenta"
          class="w-3/4 sm:w-3/5 md:w-2/5 lg:w-1/3 h-auto mx-auto"
          loading="eager"
        >
      </a>
    </div>

    <!-- Navigation -->
    <nav class="flex flex-wrap justify-center gap-2 mb-6 sm:mb-8">
      <a href="{{ url_for('vertele') }}" class="nav-link bg-green-600 hover:bg-green-700 text-white">
        {{ tr("nav.watch_tv") if tr else "Watch TV" }}
      </a>
      <a href="{{ url_for('index') }}" class="nav-link text-gray-300 {% if active_page == 'library' %}active{% endif %}">
        {{ tr("nav.library") if tr else "Library" }}
      </a>
      <a href="{{ url_for('canales') }}" class="nav-link text-gray-300 {% if active_page == 'channels' %}active{% endif %}">
        {{ tr("nav.channels") if tr else "Channels" }}
      </a>
    </nav>

    {% block content %}{% endblock %}
  </div>

  <script>
    // Language switcher
    (function() {
      const select = document.getElementById("lang-select");
      if (!select) return;

      select.addEventListener("change", async (e) => {
        const newLang = e.target.value;
        try {
          const res = await fetch("/api/language", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ lang: newLang })
          });
          if (res.ok) {
            window.location.reload();
          }
        } catch (err) {
          console.error("[I18N] Error:", err);
        }
      });
    })();

    {% block extra_scripts %}{% endblock %}
  </script>
</body>
</html>
